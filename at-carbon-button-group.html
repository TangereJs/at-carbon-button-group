<link rel="import" href="../tangere/tangere.html" />
<link rel="import" href="../at-core-style-classes/at-core-style-classes.html" />
<link rel="import" href="../at-carbon-button/at-carbon-button.html" />
<link rel="import" href="../at-carbon-button-menu/at-carbon-button-menu.html" />

<dom-module id="at-carbon-button-group">
  <template>
    <style include="at-core-style-classes">
      :host {
        display: block;
        box-sizing: border-box;
        @apply(--layout-horizontal);
      }
    </style>
    
    <div id="buttonContainer" class="layout-horizontal"></div>
    <at-carbon-button-menu id="menuButton" icon="[[moreIcon]]" label="[[moreLabel]]" hidden$="[[_computeHidden(buttons, maxButtons)]]"></at-carbon-button-menu>
  </template>
</dom-module>
<script>
  Polymer({
    is: "at-carbon-button-group",
    properties: {
      
      moreLabel: {
        type: String,
        title: "More label",
        value: 'more...'
      },

      moreIcon: {
        type: String,
        title: 'More icon',
        value: ''
      },

      maxButtons: {
        type: Number,
        title: "Max Buttons",
        value: 3
      },

      buttons: {
        type: Array,
        value: function() {
          return [];
        },
        title: "Buttons",
        xgridcols: "12",
        schema: {
          properties: {
            title: {
              type: String,
              title: "Title",
              value: ''
            },
            value: {
              type: String,
              title: "Value",
              value: ''
            },
            icon: {
              type: String,
              title: "Icon",
              value: 'now:wrench'
            }
          }
        }
      },

      value: {
        type: String,
        value: "",
        readonly: true
      }
    },

    observers: [
      '_initialize(buttons, maxButtons)'
    ],

    ready: function () {

    },

    _initialize: function(buttons, maxButtons) {
      var visibleButtons = [];
      var menuButtons = [];

      if (buttons.length <= maxButtons) {
        visibleButtons = buttons;
      
      } else {
        visibleButtons = buttons.slice(0, maxButtons-1);
        menuButtons = buttons.slice(maxButtons-1);
      }

      Polymer.dom(this.$.buttonContainer).innerHTML = '';
      visibleButtons.forEach(function(buttonDef) {
        var carbonButton = document.createElement('at-carbon-button');
        carbonButton.label = buttonDef.title;
        carbonButton.icon  = buttonDef.icon;
        carbonButton.raised = true;
        Polymer.dom(carbonButton).setAttribute('value', buttonDef.value);
        Polymer.dom(this.$.buttonContainer).appendChild(carbonButton);
      }, this);

      if (!menuButtons.length) return;
      
      this.$.menuButton.items = [];
      this.$.menuButton.items = menuButtons;
    },

    _computeHidden: function(buttons, maxButtons) {
      return buttons.length <= maxButtons;
    }

  });
</script>
